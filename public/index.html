<!doctype html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>Welcome to your Strapi app</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="//cdn.webix.com/edge/webix.css" type="text/css">
    <script src="//cdn.webix.com/edge/webix.js" type="text/javascript"></script>
  </head>
  <body lang="en">
  <script>
    webix.ui({
             	"id": "mylist",
             	"rows": [
             		{
             		  // "url": "",
             			"columns": [
             				{ "id": "id", "header": "ID", "fillspace": true, "hidden": false },
             				{ "header": "Book Name", "fillspace": true, "hidden": false, "sort": "string", "id": "bookName" },
             				{ "header": "Price", "fillspace": true, "hidden": false, "id": "price" },
             				{ "header": "Published Date", "width": 150, "fillspace": true, "hidden": false, "id": "publishedDate" },
             				{ "id": "author", "header": "Author Name", "fillspace": true, "hidden": false, "template": (obj) => {return getAuthorFieldValue(obj, "name")}},
             				{ "id": "author", "header": "Author Email", "fillspace": true, "hidden": false, "template": (obj) => {return getAuthorFieldValue(obj, "email")} },
             				{ "id": "author", "header": "Author Website", "fillspace": true, "hidden": false, "template": (obj) => {return getAuthorFieldValue(obj, "website")} },
                    { id:"",
                     template:"<input class='delbtn' type='button' value='Delete'>",
                     css:"padding_less",
                     width:100
                     },
                    { id:"",
                     template:"<input class='editbtn' type='button' value='Edit'>",
                     css:"padding_less",
                     width:100
                    }
             			],
             			"view": "datatable",
             			"fixedRowHeight": true,
             			"id": 1570449720005
             		},
             		{ "label": "ADD BOOK", "view": "label", "height": 50, "css": ".form_label" },
             		{
             			"cols": [
             				{
             					"autoheight": false,
             					"view": "form",
             					"rows": [
             						{ "label": "NAME", "view": "text", "height": 38, "required": false },
             						{
             							"cols": [
             								{ "label": "COVER IMG URL", "view": "label", "height": 0, "width": 111 },
             								{ "view": "text", "width": 0, "invalid": false, "required": true }
             							]
             						},
             						{
             							"height": 38,
             							"cols": [
             								{ "label": "PUBLISHED DATE", "view": "label", "height": 0, "width": 123 },
             								{ "value": "2019-10-07 17:31:47", "view": "datepicker", "height": 0, "width": 0 }
             							]
             						},
             						{ "view": "button", "css": "webix_primary", "label": "Save" }
             					],
             					"borderless": 1
             				},
             				{
             					"rows": [
             						{ "label": "AUTHOR DETAILS", "view": "label" },
             						{ "label": "NAME", "view": "text" },
             						{ "label": "EMAIL", "view": "text" },
             						{ "label": "WEBSITE", "view": "text" },
             						{ "view": "template", "role": "placeholder", "borderless": 1 }
             					]
             				}
             			]
             		}
             	]
             });
    getAuthorFieldValue = (obj, key) => {
       if(obj.author) {
         return obj.author[key] || "";
       }
       return "";
    };

    $$(1570449720005).load('http://localhost:1337/books');

    $$(1570449720005).on_click.delbtn= async function(e, id, trg){
      //block default onclick event
      const result = await webix.modalbox({
          title:`Delete Item`,
          buttons:["Yes", "No"],
          text:`Are you sure you want to delete the item with id\n${id}`,
          width:500
      });
      if(result === 0) {
       const result = await webix.ajax().del(`http://localhost:1337/books/${id}`);
       if(result) {
        $$(1570449720005).clearAll();
        $$(1570449720005).load('http://localhost:1337/books');
       }

      }
      return false;
    };

    $$(1570449720005).on_click.editbtn= async function(e, id, trg){
      //id.column - column id
      //block default onclick event
      const item = await webix.ajax().get(`http://localhost:1337/books/${id}`);
      webix.modalbox({
          title:"Edit Item",
          buttons:["Yes", "No"],
          text: generateEditHtml(item.json()),
          width:500
      });
      return false;
    };

    generateEditHtml = (item) => {
      const d = item.publishedDate.toString().substring(0,10).split().reverse().join();
     return (`
     <div>
        <div>
        <label>
            Book Name:
            <input type="text" value='${item.bookName}'/>
        </label>
        </div>
        <div>
        <label>
            Price:
            <input type="text" value='${item.price}'/>
        </label>
        </div>
        <div>
        <div>
        <label>
            Book Cover:
            <input type="text" value='${item.bookCover}'/>
        </label>
        </div>
        <label>
            Published Date:
            <input type="date" value='${d}'/>
        </label>
        </div>
        <div>
            <h3>Author Details</h3>
            <div>
            <label>
                Author Name:
                <input type="text" value='${item.author.name}'/>
            </label>
            </div>
            <div>
            <label>
                Author Email:
                <input type="text" value='${item.author.email}'/>
            </label>
            </div>
            <div>
            <label>
                Author Website:
                <input type="text" value='${item.author.website}'/>
            </label>
            </div>
        </div>
     </div>
     `);
    }
  </script>
  </body>
</html>
